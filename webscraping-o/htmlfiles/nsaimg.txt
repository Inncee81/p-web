<!DOCTYPE html>
<html lang="zh-CN">
 <head>
  <meta charset="utf-8"/>
  <meta content="no-siteapp" http-equiv="Cache-Control"/>
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
  <meta content="webkit" name="renderer"/>
  <meta content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <meta content="nsaimg" name="keywords"/>
  <meta content="nsaimg, Your photo album on the cloud." name="description"/>
  <title>
   nsaimg
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/css/fileinput.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" rel="stylesheet" rossorigin="anonymous"/>
  <link href="/favicon.ico" rel="shortcut icon"/>
  <link href="/static/app/iconfont/iconfont.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css" rel="stylesheet"/>
  <link href="/static/app/css/app.css?v=1.4" rel="stylesheet"/>
  <link href="/static/app/css/markdown.css?v=1.0" rel="stylesheet"/>
  <!--[if IE]>
  <script>window.location.href = '/compatibility.html';</script>
  <![endif]-->
 </head>
 <body class="mdui-theme-accent-indigo mdui-appbar-with-toolbar">
  <!-- 可以直接引入第三方css样式 -->
  <style>
   /* body {} */
  </style>
  <div class="mdui-appbar mdui-appbar-fixed">
   <div class="mdui-toolbar mdui-color-black">
    <span class="mdui-btn mdui-btn-icon open-menu" mdui-drawer="{target: '#menu'}">
     <i class="mdui-icon material-icons">
      
     </i>
    </span>
    <a class="mdui-typo-headline" href="/">
     nsaimg
    </a>
    <div class="mdui-toolbar-spacer">
    </div>
    <!-- Theme -->
    <a class="mdui-btn mdui-btn-icon" href="javascript:app.toggleTheme()" id="set-theme">
     <i class="mdui-icon material-icons">
      
     </i>
    </a>
   </div>
  </div>
  <div class="mdui-drawer mdui-drawer-close" id="menu">
   <div class="mdui-list" mdui-collapse="{accordion: true}">
    <a class="mdui-list-item mdui-ripple mdui-list-item-active" href="/">
     <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">
      
     </i>
     <div class="mdui-list-item-content">
      首页
     </div>
    </a>
    <a class="mdui-list-item mdui-ripple" href="/auth/login.html">
     <i class="mdui-list-item-icon mdui-icon material-icons iconfont icon-login mdui-text-color-teal">
     </i>
     <div class="mdui-list-item-content">
      登录
     </div>
    </a>
    <a class="mdui-list-item mdui-ripple" href="/auth/register.html">
     <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-purple">
      
     </i>
     <div class="mdui-list-item-content">
      注册
     </div>
    </a>
   </div>
  </div>
  <div class="mdui-container">
   <main>
    <div class="upload-container">
     <div class="title">
      <h1>
       Image Upload
      </h1>
      <p>
       最大可上传 20.00 MB 的图片，单次同时可选择 50 张。本站已托管 215166 张图片。
      </p>
     </div>
     <form action="" enctype="multipart/form-data" method="post">
      <input accept="image/*" id="image" multiple="" name="image" style="display: none;" type="file"/>
     </form>
     <div class="success-info">
      <div class="mdui-tab mdui-tab-scrollable" mdui-tab="">
       <!--a href="#code-html" class="mdui-ripple">HTML</a-->
       <a class="mdui-ripple mdui-tab-active" href="#code-bbcode">
        BBCode
       </a>
       <!--a href="#code-markdown" class="mdui-ripple">Markdown</a-->
       <!--a href="#code-markdown-with-link" class="mdui-ripple">Markdown with link</a-->
       <a class="mdui-ripple" href="#code-url">
        URL
       </a>
      </div>
      <!--div id="code-html"><ul></ul></div-->
      <div id="code-bbcode">
       <ul>
        <li data-index="0">
        </li>
       </ul>
      </div>
      <!--div id="code-markdown"><ul></ul></div-->
      <!--div id="code-markdown-with-link"><ul></ul></div-->
      <div id="code-url">
       <ul>
       </ul>
      </div>
     </div>
    </div>
   </main>
  </div>
  <div class="mdui-fab-wrapper">
   <button class="mdui-fab mdui-ripple mdui-fab-hide mdui-color-theme-accent" id="to-top">
    <i class="mdui-icon material-icons">
     
    </i>
   </button>
  </div>
  <div id="loading-container">
   <div class="mask">
   </div>
   <div class="loading">
    <div class="mdui-spinner mdui-spinner-colorful">
    </div>
   </div>
  </div>
  <footer>
   <div class="mdui-container">
    Copyright © 2021 - All rights reserved.
   </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/marked@0.8.0/marked.min.js">
  </script>
  <script src="/static/app/js/app.js?v=1.2">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/js/plugins/piexif.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/js/plugins/sortable.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/js/plugins/purify.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/js/fileinput.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/themes/fas/theme.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.0.7/js/locales/zh.js">
  </script>
  <script>
   var clipboard = new ClipboardJS('.copy', {
    text: function(trigger) {
      return $(trigger).parent('li').text();
    }
  });

  clipboard.on('success', function(e) {
    app.msg(true, '复制成功');
  });

  clipboard.on('error', function(e) {
    app.msg(false, '复制失败');
  });

  var sort = function (uls) {
    for (var i = 0; i < uls.length; i++) {
      var sortEle = $(uls[i]).find('li').sort(function (a, b) {
        return $(a).data('index') > $(b).data('index') ? 1 : -1;
      });
      $(uls[i]).empty().append(sortEle);
    }
  };

  $("#image").fileinput({
    uploadUrl: "/upload/upload.html",
    language: "zh",
    theme: "fas",
    previewFileType: "image",
    autoOrientImage: true,
    uploadAsync: true,
    overwriteInitial: false,
    maxFileSize: "20480",// kb
    maxFileCount: "50",
    showCaption: true,
    dropZoneEnabled: true,
    browseIcon: "<i class=\"fas fa-images\"></i> ",
    allowedFileExtensions: JSON.parse('["jpg","jpeg","gif","png","ico"]'),
  }).on("fileuploaded", function(event, data, previewId, index) {
    var form = data.form, files = data.files, extra = data.extra, response = data.response, reader = data.reader;
    if(200 === response.code) {
      $("#code-bbcode ul li").prepend("[url=https://nsaimg.com/i/?i=" + response.data.url2 + "]" + "[img]"+ response.data.url + "[/img][/url]<i class=\"copy iconfont icon-copy\"></i>\n");
      $("#code-markdown ul").prepend("<li data-index=" + index + ">![" + response.data.name + "](" + response.data.url + ")<i class=\"copy iconfont icon-copy\"></i></li>");
      $("#code-markdown-with-link ul").prepend("<li data-index=" + index + ">[![" + response.data.name + "](" + response.data.url + ")](" + response.data.url + ")<i class=\"copy iconfont icon-copy\"></i></li>");
      // 排序
      //sort(['#code-url ul', '#code-html ul', '#code-bbcode ul', '#code-markdown ul', '#code-markdown-with-link ul']);
      sort(['#code-bbcode ul','#code-url ul']);

      $(".success-info").css("width", "inherit").css('display', 'block');
      if (response.data.quota && response.data.use_quota) {
        $('.quota-container progress').attr('max', response.data.quota);
        $('.quota-container progress').val(response.data.use_quota);
        $('.quota-container span.quota').text(app.bytesToSize(response.data.quota));
        $('.quota-container span.use-quota').text(app.bytesToSize(response.data.use_quota));
      }
    } else if (500 === response.code) {
      mdui.alert(response.msg, '发生异常');
    } else {
      mdui.alert(response.msg);
    }
  }).on("filecleared", function (event, data, msg) {
    // 清空
    $('.success-info')
      .css('display', 'none')
      .find('#code-url, #code-html, #code-bbcode, #code-markdown, #code-markdown-with-link')
      .find('ul')
      .html('');
  });
  $('#image').css("display", "block");

  $('.success-info ul').on('mouseenter', "li", function() {
    $('.file-preview .file-drop-zone .file-preview-thumbnails > [data-template=image]').eq($(this).data('index')).addClass('hover');
  }).on('mouseout', 'li', function () {
    $('.file-preview .file-drop-zone .file-preview-thumbnails > [data-template=image]').eq($(this).data('index')).removeClass('hover');
  });
  </script>
  <script>
   // Originate from https://sm.ms
  document.addEventListener('paste', function (event) {
    var isChrome = false;
    if ( event.clipboardData || event.originalEvent ) {
      var clipboardData = (event.clipboardData || event.originalEvent.clipboardData);
      if ( clipboardData.items ) {
        // for chrome
        var  items = clipboardData.items,
          len = items.length,
          blob = null;
        isChrome = true;

        event.preventDefault();

        let images = [];
        for (var i = 0; i < len; i++) {
          if (items[i].type.indexOf("image") !== -1) {
            blob = items[i].getAsFile();
            images.push(blob);
          }
        }
        if(images.length > 0) {
          uploadBlobFile(images);
        }
        if ( blob !== null ) {
          var reader = new FileReader();
          reader.onload = function (event) {
            var base64_str = event.target.result;
          }

        }
      } else {
        //for firefox
      }
    } else {
    }
  });

  function uploadBlobFile(images) {
    var form = $("#image");
    mdui.confirm('是否上传粘贴的图片?', function() {
      $('.file-drop-zone-title').remove();
      form.fileinput('readFiles', images);
      setTimeout(function () {
        form.fileinput('upload');
      }, 400)
    }, function () {}, {
      confirmText: '确定',
      cancelText: '取消'
    });
  }
  </script>
  <script>
   var ver = '1.6.0';
  $(function () {
    var toTop = $("#to-top"), toTopHide = function () {
      if ($(window).scrollTop() > 50) {
        toTop.removeClass('mdui-fab-hide');
      } else {
        toTop.addClass('mdui-fab-hide');
      }
    };
    if ($(window).scrollTop() > 50) {
      toTopHide();
    }
    $(window).scroll(function() {
      toTopHide();
    });

    toTop.click(function () {
      $('body,html').animate({ scrollTop: 0 }, 500);
    });

    $('.open-menu').click(function () {
      if ($(window).width() > 1024) {
        app.cookie.set('menu', $('body').hasClass('mdui-drawer-body-left') ? 'open' : 'close', 10, '/');
      }
    });

    $('#update').click(function () {
      app.getLastVer(ver, true);
    });

    $('body').on('click', '.markdown-body a', function (e) {
      e.preventDefault();
      window.open(this.href, '_blank');
    });
  });
  </script>
  <script>
   // js统计代码
  </script>
 </body>
</html>
